<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Dj-Stripe Team">
  <link rel="canonical" href="https://dj-stripe.github.io/dj-stripe/project/test_fixtures/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Test Fixtures - Dj-Stripe</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Test Fixtures";
    var mkdocs_page_input_path = "project/test_fixtures.md";
    var mkdocs_page_url = "/dj-stripe/project/test_fixtures/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dj-Stripe</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sponsors/">Sponsors</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api_keys/">Managing Stripe API Keys</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../api_versions/">A note on Stripe API Versions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../stripe_elements_js/">Integrating Stripe Elements</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Release notes</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/2_5_0/">dj-stripe 2.5 release notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_x/">dj-stripe 2.4.1 release notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_0/">dj-stripe 2.4 release notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/2_x/">dj-stripe 2.0 ~ 2.3 release notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/1_x/">dj-stripe 1.x release notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../history/0_x/">dj-stripe 0.x release notes</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Usage</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/webhooks/">Using Stripe Webhooks</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/subscribing_customers/">Subscribing a customer to a plan</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/managing_subscriptions/">Managing subscriptions and payment sources</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/manually_syncing_with_stripe/">Manually syncing data with Stripe</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_individual_charges/">Creating individual charges</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_usage_record/">Creating Usage Records</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/using_stripe_checkout/">Using Stripe Checkout</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../usage/using_with_docker/">Using with Docker</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Project</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Test Fixtures</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#rationale">Rationale</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#regenerating-the-test-fixtures">Regenerating the test fixtures</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../authors/">Credits</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../support/">Support</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../release_process/">Release Process</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/context_managers/">Context Managers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/enums/">Enumerations</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/managers/">Managers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/models/">Models</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/settings/">Settings</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../reference/utils/">Utilities</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dj-Stripe</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Project &raquo;</li>
        
      
    
    <li>Test Fixtures</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/dj-stripe/dj-stripe/edit/master/docs/project/test_fixtures.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="test-fixtures">Test Fixtures</h1>
<p>dj-stripe's unit tests rely on fixtures to represent Stripe API and
webhook data.</p>
<h2 id="rationale">Rationale</h2>
<p>These fixtures are partly hand-coded and partly generated by creating
objects in Stripe and then retrieved via the API.</p>
<p>Each approach has pros and cons:</p>
<p>Hand-coding the fixtures allows them to be crafted specifically for a
test case. They can also be terse, and nested objects can be done by
reference to avoid duplication. But maintaining or upgrading them is a
painstaking manual process.</p>
<p>Generating the fixtures via Stripe gives the big advantage that Stripe
schema changes are automatically represented in the fixtures, which
should allow us to upgrade dj-stripe's schema to match Stripe much more
easily. This would be done by updating dj-stripe's targeted API version
(<span class="title-ref">DEFAULT_STRIPE_API_VERSION</span>),
regenerating the fixtures, and updating the model to match the fixture
changes. The down side is it's tricky to regenerate fixture files
without introducing big changes (eg to object ids) - the script does
this by mapping a dummy id to various objects.</p>
<h2 id="regenerating-the-test-fixtures">Regenerating the test fixtures</h2>
<p>To regenerate the test fixtures (e.g. to populate the fixtures with new
API fields from Stripe), do the following:</p>
<ol>
<li>
<p>(one time only) Create a new Stripe account called "dj-stripe
    scratch", with country set to United States. (we use US so the
    currency matches the existing fixtures matches, in the future it
    would be good to test for other countries).</p>
</li>
<li>
<p>If you already had this account ready and want to start again from
    scratch, you can delete all of the test data via the button in
    Settings &gt; Data <a href="https://dashboard.stripe.com/account/data">https://dashboard.stripe.com/account/data</a></p>
</li>
<li>
<p>Activate a virtualenv with the dj-stripe project (see Getting
    Started)</p>
</li>
<li>
<p>Set the dj-stripe secret key environment variable to the secret key
    for this account (<code>export STRIPE_SECRET_KEY=sk_test_...</code>)</p>
</li>
<li>
<p>Run the manage command to create the test objects in your stripe
    account if they don't already exist, and regenerate the local
    fixture files from them:</p>
<div class="codehilite"><pre><span></span><code>$ ./manage.py regenerate_test_fixtures
</code></pre></div>

</li>
</ol>
<p>The command tries to avoid inconsequential changes to the fixtures (e.g
the <span class="title-ref">created</span> timestamp) by restoring a
whitelist of values from the existing fixtures.</p>
<p>This functionality can be disabled by passing the parameter <span
class="title-ref">--update-sideeffect-fields</span>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../authors/" class="btn btn-neutral float-right" title="Credits">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../contributing/" class="btn btn-neutral" title="Contributing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dj-stripe/dj-stripe/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../contributing/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../authors/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
